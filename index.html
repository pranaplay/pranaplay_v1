<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PranaPlay</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #FFDDD2; margin: 0; font-family: -apple-system, system-ui, sans-serif; -webkit-tap-highlight-color: transparent; }
        .app-card { background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(10px); border-radius: 2.5rem; border: 1px solid white; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.1); }
        .progress-bar { transition: width 0.6s cubic-bezier(0.34, 1.56, 0.64, 1); }
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        // Wrap everything in a function to prevent global scope errors
        window.onload = () => {
            const { useState, useEffect, useMemo } = React;

            const ASANA_DATA = [
                { id: 1, level: "Seed", sanskrit: "Tadasana", english: "Mountain Pose", benefits: "Improves posture, strengthens thighs." },
                { id: 2, level: "Seed", sanskrit: "Vrikshasana", english: "Tree Pose", benefits: "Improves balance and strengthens legs." },
                { id: 3, level: "Seed", sanskrit: "Adho Mukha Svanasana", english: "Downward Dog", benefits: "Energizes the body and stretches shoulders." },
                { id: 8, level: "Seed", sanskrit: "Balasana", english: "Child's Pose", benefits: "Gently stretches hips and calms the mind." },
                { id: 16, level: "Sprout", sanskrit: "Phalakasana", english: "Plank Pose", benefits: "Strengthens the core and arms." },
                { id: 56, level: "Yogi", sanskrit: "Bakasana", english: "Crow Pose", benefits: "Strengthens wrists and abdominal muscles." }
            ];

            const LEVELS = [
                { min: 0, max: 150, name: "Seed", emoji: "üå±", color: "text-green-600" },
                { min: 151, max: 400, name: "Sprout", emoji: "üåø", color: "text-emerald-500" },
                { min: 401, max: 800, name: "Bloom", emoji: "üå∏", color: "text-rose-400" },
                { min: 801, max: 9999, name: "Yogi", emoji: "üèÜ", color: "text-amber-500" }
            ];

            const App = () => {
                const [screen, setScreen] = useState('start');
                const [score, setScore] = useState(0);
                const [highScore, setHighScore] = useState(0);
                const [currentQuestion, setCurrentQuestion] = useState(null);
                const [selectedAnswer, setSelectedAnswer] = useState(null);
                const [isCorrect, setIsCorrect] = useState(false);

                useEffect(() => {
                    const saved = localStorage.getItem('pranaplay_highscore');
                    if (saved) setHighScore(parseInt(saved));
                }, []);

                const levelInfo = useMemo(() => {
                    return LEVELS.find(l => score >= l.min && score <= l.max) || LEVELS[0];
                }, [score]);

                const generateQuestion = () => {
                    const unlockedLevels = LEVELS.slice(0, LEVELS.indexOf(levelInfo) + 1).map(l => l.name);
                    const pool = ASANA_DATA.filter(p => unlockedLevels.includes(p.level));
                    const pose = pool[Math.floor(Math.random() * pool.length)];
                    const type = Math.random() > 0.5 ? 'S_TO_E' : 'E_TO_S';
                    const distractors = ASANA_DATA
                        .filter(p => p.id !== pose.id)
                        .sort(() => 0.5 - Math.random())
                        .slice(0, 3);
                    const options = [...distractors, pose].sort(() => 0.5 - Math.random());

                    setCurrentQuestion({
                        pose, type, options,
                        correctAnswer: type === 'E_TO_S' ? pose.sanskrit : pose.english
                    });
                    setSelectedAnswer(null);
                };

                const handleAnswer = (answer) => {
                    if (selectedAnswer) return;
                    const correct = answer === currentQuestion.correctAnswer;
                    setSelectedAnswer(answer);
                    setIsCorrect(correct);
                    if (correct) {
                        const newScore = score + 10;
                        setScore(newScore);
                        if (newScore > highScore) {
                            setHighScore(newScore);
                            localStorage.setItem('pranaplay_highscore', newScore.toString());
                        }
                    }
                    setTimeout(() => setScreen('resolution'), 800);
                };

                return (
                    <div className="min-h-screen p-4 flex flex-col items-center justify-center">
                        <div className="max-w-md w-full app-card flex flex-col min-h-[600px] overflow-hidden">
                            <div className="pt-8 px-8 flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold text-[#E29578]">PranaPlay</h1>
                                    <p className="text-[#E29578]/50 text-[10px] font-bold uppercase tracking-widest">Linguistic Yoga</p>
                                </div>
                                <div className="text-right">
                                    <div className="text-[#FFB703] font-bold text-lg">üèÜ {highScore}</div>
                                    <div className={`${levelInfo.color} text-xs font-bold`}>{levelInfo.emoji} {levelInfo.name}</div>
                                </div>
                            </div>

                            <div className="p-8 flex-1 flex flex-col">
                                {screen === 'start' ? (
                                    <div className="flex-1 flex flex-col items-center justify-center text-center">
                                        <div className="text-7xl mb-6">üßò</div>
                                        <h2 className="text-2xl font-bold text-gray-700 mb-2">Ready to Flow?</h2>
                                        <p className="text-gray-400 text-sm mb-8">Master your Sanskrit terminology</p>
                                        <button 
                                            onClick={() => { setScore(0); generateQuestion(); setScreen('quiz'); }}
                                            className="w-full bg-[#E29578] text-white font-bold py-5 rounded-full shadow-lg active:scale-95 transition-all"
                                        >
                                            Begin Practice
                                        </button>
                                    </div>
                                ) : screen === 'quiz' ? (
                                    <div className="flex-1 flex flex-col">
                                        <div className="bg-[#FFDDD2]/50 p-6 rounded-3xl text-center mb-8 border border-white">
                                            <p className="text-[10px] font-bold text-[#E29578] uppercase mb-2">Translate</p>
                                            <h3 className="text-2xl font-bold text-gray-800">
                                                {currentQuestion.type === 'S_TO_E' ? currentQuestion.pose.sanskrit : currentQuestion.pose.english}
                                            </h3>
                                        </div>
                                        <div className="grid gap-3">
                                            {currentQuestion.options.map((opt, i) => {
                                                const val = currentQuestion.type === 'E_TO_S' ? opt.sanskrit : opt.english;
                                                const isCorrectChoice = val === currentQuestion.correctAnswer;
                                                let style = "p-4 rounded-2xl border-2 font-medium transition-all text-left ";
                                                if (!selectedAnswer) style += "bg-white border-white text-gray-700";
                                                else if (isCorrectChoice) style += "bg-green-100 border-green-500 text-green-800";
                                                else if (selectedAnswer === val) style += "bg-red-100 border-red-500 text-red-800";
                                                else style += "opacity-30 border-transparent";
                                                return (
                                                    <button key={i} onClick={() => handleAnswer(val)} className={style}>{val}</button>
                                                );
                                            })}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="flex-1 flex flex-col">
                                        <div className={`p-6 rounded-3xl text-center mb-6 ${isCorrect ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'}`}>
                                            <h2 className="text-xl font-bold">{isCorrect ? 'Correct! ‚ú®' : 'Incorrect ‚òÅÔ∏è'}</h2>
                                        </div>
                                        <div className="bg-white p-6 rounded-2xl mb-8">
                                            <h4 className="font-bold text-gray-800">{currentQuestion.pose.sanskrit}</h4>
                                            <p className="text-[#E29578] italic mb-2">{currentQuestion.pose.english}</p>
                                            <p className="text-xs text-gray-500">{currentQuestion.pose.benefits}</p>
                                        </div>
                                        <button 
                                            onClick={() => { generateQuestion(); setScreen('quiz'); }}
                                            className="w-full bg-[#E29578] text-white font-bold py-5 rounded-full mt-auto"
                                        >
                                            Next Pose
                                        </button>
                                    </div>
                                )}
                            </div>
                            
                            {screen !== 'start' && (
                                <div className="px-8 pb-8">
                                    <div className="h-2 w-full bg-gray-100 rounded-full">
                                        <div className="h-full bg-[#FFB703] progress-bar rounded-full" style={{ width: `${Math.min(100, (score / 800) * 100)}%` }}></div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                );
            };

            const root = ReactDOM.createRoot(document.getElementById('root'));
            root.render(<App />);
        };
    </script>
</body>
</html>
